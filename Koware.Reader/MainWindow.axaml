<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Koware.Reader"
        x:Class="Koware.Reader.MainWindow"
        x:DataType="local:MainWindow"
        Title="Koware Reader"
        Width="1000" Height="800"
        MinWidth="600" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        Background="#0f172a"
        KeyDown="OnKeyDown">
    
    <Window.Resources>
        <!-- Theme colors as resources for dynamic switching -->
        <SolidColorBrush x:Key="ReaderBg" Color="#0f172a" />
        <SolidColorBrush x:Key="ReaderPanel" Color="#0f172a" />
        <SolidColorBrush x:Key="ReaderBorder" Color="#1e293b" />
        <SolidColorBrush x:Key="ReaderText" Color="#e2e8f0" />
        <SolidColorBrush x:Key="ReaderMuted" Color="#94a3b8" />
        <SolidColorBrush x:Key="ReaderAccent" Color="#38bdf8" />
    </Window.Resources>
    
    <Window.Styles>
        <!-- Toolbar buttons matching Windows style -->
        <Style Selector="Button.toolbar">
            <Setter Property="Background" Value="#141e32" />
            <Setter Property="Foreground" Value="#e2e8f0" />
            <Setter Property="BorderBrush" Value="#2a3a52" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="MinHeight" Value="32" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>
        <Style Selector="Button.toolbar:pointerover">
            <Setter Property="Background" Value="#1e2d45" />
            <Setter Property="BorderBrush" Value="#3a4a62" />
        </Style>
        <Style Selector="Button.toolbar:pressed">
            <Setter Property="Background" Value="#0f1a2a" />
        </Style>
        <Style Selector="Button.toolbar.active">
            <Setter Property="Background" Value="#1e3a5f" />
            <Setter Property="BorderBrush" Value="#38bdf8" />
            <Setter Property="Foreground" Value="#38bdf8" />
        </Style>
        
        <!-- Small toolbar buttons -->
        <Style Selector="Button.toolbar-sm">
            <Setter Property="Background" Value="#141e32" />
            <Setter Property="Foreground" Value="#e2e8f0" />
            <Setter Property="BorderBrush" Value="#2a3a52" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="6,5" />
            <Setter Property="MinHeight" Value="28" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>
        <Style Selector="Button.toolbar-sm:pointerover">
            <Setter Property="Background" Value="#1e2d45" />
        </Style>
        
        <!-- Nav buttons -->
        <Style Selector="Button.nav-btn">
            <Setter Property="Background" Value="#141e32" />
            <Setter Property="Foreground" Value="#e2e8f0" />
            <Setter Property="BorderBrush" Value="#2a3a52" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="MinHeight" Value="36" />
        </Style>
        <Style Selector="Button.nav-btn:pointerover">
            <Setter Property="Background" Value="#1e2d45" />
        </Style>
        <Style Selector="Button.nav-btn:disabled">
            <Setter Property="Opacity" Value="0.4" />
        </Style>
        
        <!-- Chapter nav buttons -->
        <Style Selector="Button.chapter-nav">
            <Setter Property="Background" Value="#141e32" />
            <Setter Property="Foreground" Value="#e2e8f0" />
            <Setter Property="BorderBrush" Value="#2a3a52" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="MinHeight" Value="32" />
            <Setter Property="FontSize" Value="11" />
        </Style>
        <Style Selector="Button.chapter-nav:disabled">
            <Setter Property="Opacity" Value="0.3" />
        </Style>
        
        <!-- Page slider -->
        <Style Selector="Slider#PageSlider">
            <Setter Property="Height" Value="32" />
            <Setter Property="Margin" Value="0,-4,0,-4" />
        </Style>
        <Style Selector="Slider#PageSlider /template/ Track">
            <Setter Property="Height" Value="6" />
            <Setter Property="MinHeight" Value="6" />
        </Style>
        <Style Selector="Slider#PageSlider /template/ RepeatButton.track">
            <Setter Property="Height" Value="6" />
        </Style>
        <Style Selector="Slider#PageSlider /template/ Thumb">
            <Setter Property="Width" Value="18" />
            <Setter Property="Height" Value="18" />
            <Setter Property="Background" Value="#94a3b8" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Ellipse Width="18" Height="18" Fill="{TemplateBinding Background}" />
                </ControlTemplate>
            </Setter>
        </Style>
        <Style Selector="Slider#PageSlider /template/ Thumb:pointerover">
            <Setter Property="Background" Value="#38bdf8" />
        </Style>
        <Style Selector="Slider#PageSlider /template/ Thumb:pressed">
            <Setter Property="Background" Value="#0ea5e9" />
        </Style>
        
        <!-- Dropdown menu items -->
        <Style Selector="Button.dropdown-item">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="#e2e8f0" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="CornerRadius" Value="5" />
            <Setter Property="FontSize" Value="12" />
        </Style>
        <Style Selector="Button.dropdown-item:pointerover">
            <Setter Property="Background" Value="#1e2d45" />
        </Style>
        <Style Selector="Button.dropdown-item.active">
            <Setter Property="Background" Value="#1e3a5f" />
            <Setter Property="Foreground" Value="#38bdf8" />
        </Style>
        
        <!-- Chapter list items -->
        <Style Selector="Border.chapter-item">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="10,10" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="Border.chapter-item:pointerover">
            <Setter Property="Background" Value="#1a2438" />
        </Style>
        <Style Selector="Border.chapter-item.current">
            <Setter Property="Background" Value="#1e3a5f" />
            <Setter Property="BorderBrush" Value="#38bdf8" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>
        
        <!-- Overlays -->
        <Style Selector="Border.overlay">
            <Setter Property="Opacity" Value="1" />
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                </Transitions>
            </Setter>
        </Style>
        
        <!-- Shortcut rows -->
        <Style Selector="Border.shortcut-row">
            <Setter Property="Background" Value="#0a1220" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="Margin" Value="0,0,0,4" />
        </Style>
        <Style Selector="Border.shortcut-row.alt">
            <Setter Property="Background" Value="#0f1a2a" />
        </Style>
    </Window.Styles>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="#0f172a"
                BorderBrush="#1e293b"
                BorderThickness="0,0,0,1"
                Padding="16,10"
                x:Name="HeaderBar">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBlock x:Name="TitleText"
                           Grid.Column="0"
                           Text="Koware Reader"
                           FontSize="14"
                           FontWeight="Bold"
                           Foreground="#e2e8f0"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis" />
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                    <!-- Chapters button - prominent like Windows reader -->
                    <Button x:Name="ChaptersButton" Classes="toolbar"
                            Click="OnChaptersClick"
                            ToolTip.Tip="Chapters list (C)"
                            Background="#1e3a5f"
                            BorderBrush="#38bdf8">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Viewbox Width="16" Height="16" Stretch="Uniform">
                                <Canvas Width="24" Height="24">
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="2" Fill="Transparent" Data="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="2" Fill="Transparent" Data="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="1.5" Data="M8 7h8M8 11h8M8 15h5" />
                                </Canvas>
                            </Viewbox>
                            <TextBlock Text="Chapters" VerticalAlignment="Center" FontWeight="SemiBold" />
                        </StackPanel>
                    </Button>
                    
                    <!-- RTL button -->
                    <Button x:Name="RtlButton" Classes="toolbar-sm"
                            Click="OnRtlClick"
                            ToolTip.Tip="Right-to-Left reading (R)">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="RTL" VerticalAlignment="Center" />
                            <Viewbox Width="14" Height="14" Stretch="Uniform">
                                <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2" Data="M17 4H10c-2.76 0-5 2.24-5 5s2.24 5 5 5h1M7 14l-4 4 4 4M17 4v16" />
                            </Viewbox>
                        </StackPanel>
                    </Button>
                    
                    <!-- Double page button -->
                    <Button x:Name="DoublePageButton" Classes="toolbar-sm"
                            Click="OnDoublePageClick"
                            ToolTip.Tip="Double page spread (P)">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock x:Name="DoublePageText" Text="1-Page" VerticalAlignment="Center" />
                            <Viewbox Width="14" Height="14" Stretch="Uniform">
                                <Canvas Width="24" Height="24">
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="2" Data="M4 19.5A2.5 2.5 0 0 1 6.5 17H12V3H6.5A2.5 2.5 0 0 0 4 5.5v14z" />
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="2" Data="M20 19.5A2.5 2.5 0 0 0 17.5 17H12V3h5.5A2.5 2.5 0 0 1 20 5.5v14z" />
                                </Canvas>
                            </Viewbox>
                        </StackPanel>
                    </Button>
                    
                    <!-- Fit mode dropdown -->
                    <Button x:Name="FitModeButton" Classes="toolbar-sm"
                            ToolTip.Tip="Fit mode (W)">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock x:Name="FitModeText" Text="Fit Width" VerticalAlignment="Center" />
                            <Viewbox Width="14" Height="14" Stretch="Uniform">
                                <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2" Data="M21 12H3M21 12l-4-4m4 4l-4 4M3 12l4-4m-4 4l4 4" />
                            </Viewbox>
                        </StackPanel>
                        <Button.Flyout>
                            <Flyout Placement="BottomEdgeAlignedRight">
                                <Border Background="#0f172aF8" CornerRadius="8" Padding="4" MinWidth="120">
                                    <StackPanel Spacing="2">
                                        <Button Classes="dropdown-item" Tag="width" Click="OnFitModeSelected" Content="Fit Width" />
                                        <Button Classes="dropdown-item" Tag="height" Click="OnFitModeSelected" Content="Fit Height" />
                                        <Button Classes="dropdown-item" Tag="original" Click="OnFitModeSelected" Content="Original Size" />
                                    </StackPanel>
                                </Border>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                    
                    <!-- Zoom dropdown -->
                    <Button x:Name="ZoomButton" Classes="toolbar-sm"
                            ToolTip.Tip="Zoom level">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock x:Name="ZoomText" Text="100%" VerticalAlignment="Center" />
                            <Viewbox Width="14" Height="14" Stretch="Uniform">
                                <Canvas Width="24" Height="24">
                                    <Ellipse Width="16" Height="16" Canvas.Left="3" Canvas.Top="3"
                                             Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                             StrokeThickness="2" />
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="2" Data="M21 21l-4.35-4.35M11 8v6M8 11h6" />
                                </Canvas>
                            </Viewbox>
                        </StackPanel>
                        <Button.Flyout>
                            <Flyout Placement="BottomEdgeAlignedRight">
                                <Border Background="#0f172aF8" CornerRadius="8" Padding="4" MinWidth="100">
                                    <StackPanel Spacing="2">
                                        <Button Classes="dropdown-item" Tag="100" Click="OnZoomSelected" Content="100%" />
                                        <Button Classes="dropdown-item" Tag="125" Click="OnZoomSelected" Content="125%" />
                                        <Button Classes="dropdown-item" Tag="150" Click="OnZoomSelected" Content="150%" />
                                        <Button Classes="dropdown-item" Tag="175" Click="OnZoomSelected" Content="175%" />
                                        <Button Classes="dropdown-item" Tag="200" Click="OnZoomSelected" Content="200%" />
                                    </StackPanel>
                                </Border>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                    
                    <!-- Mode button (Scroll/Page) -->
                    <Button x:Name="ModeButton" Classes="toolbar-sm"
                            Click="OnModeClick"
                            ToolTip.Tip="Reading mode (M)">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock x:Name="ModeText" Text="Scroll" VerticalAlignment="Center" />
                            <Viewbox Width="14" Height="14" Stretch="Uniform">
                                <Path x:Name="ModeIcon" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2" Data="M12 3v18M12 3l4 4M12 3L8 7M12 21l4-4M12 21l-4-4" />
                            </Viewbox>
                        </StackPanel>
                    </Button>
                    
                    <!-- Theme dropdown -->
                    <Button x:Name="ThemeButton" Classes="toolbar-sm"
                            ToolTip.Tip="Theme">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock x:Name="ThemeText" Text="Dark" VerticalAlignment="Center" />
                            <Viewbox Width="14" Height="14" Stretch="Uniform">
                                <Canvas Width="24" Height="24">
                                    <Ellipse Width="10" Height="10" Canvas.Left="7" Canvas.Top="7"
                                             Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                             StrokeThickness="2" />
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                          StrokeThickness="2" Data="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                                </Canvas>
                            </Viewbox>
                        </StackPanel>
                        <Button.Flyout>
                            <Flyout Placement="BottomEdgeAlignedRight">
                                <Border Background="#0f172aF8" CornerRadius="8" Padding="4" MinWidth="130">
                                    <StackPanel Spacing="2">
                                        <Button Classes="dropdown-item" Tag="dark" Click="OnThemeSelected" Content="Dark" />
                                        <Button Classes="dropdown-item" Tag="sepia" Click="OnThemeSelected" Content="Sepia" />
                                        <Button Classes="dropdown-item" Tag="light" Click="OnThemeSelected" Content="Light" />
                                        <Button Classes="dropdown-item" Tag="contrast" Click="OnThemeSelected" Content="High Contrast" />
                                    </StackPanel>
                                </Border>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content -->
        <Border Grid.Row="1" Background="{DynamicResource ReaderBackground}" x:Name="ContentWrapper">
            <Grid>
                <ScrollViewer x:Name="ScrollViewer"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              Background="{DynamicResource ReaderBackground}">
                    <StackPanel x:Name="PagesContainer"
                                HorizontalAlignment="Center"
                                Margin="0,8">
                        <!-- Pages will be added dynamically -->
                    </StackPanel>
                </ScrollViewer>
                <Rectangle x:Name="ComfortOverlay"
                           Fill="#000000"
                           Opacity="0"
                           IsHitTestVisible="False" />
            </Grid>
        </Border>
        
        <!-- Loading Overlay -->
        <Border x:Name="LoadingOverlay"
                Grid.Row="1"
                Background="#cc1a1a2e"
                IsVisible="True">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Width="300">
                <TextBlock Text="Loading pages..."
                           Foreground="White"
                           FontSize="20"
                           HorizontalAlignment="Center" />
                <ProgressBar x:Name="LoadingProgressBar"
                             Minimum="0" Maximum="100" Value="0"
                             Height="8"
                             Margin="0,16,0,8"
                             Background="#333"
                             Foreground="#60a5fa" />
                <TextBlock x:Name="LoadingProgress"
                           Text="0 / 0"
                           Foreground="#888"
                           FontSize="14"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>
        
        <!-- Footer Navigation -->
        <Border Grid.Row="2"
                Background="#0f172a"
                BorderBrush="#1e293b"
                BorderThickness="0,1,0,0"
                Padding="16,6"
                x:Name="FooterBar">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <!-- Left nav controls -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <!-- Previous chapter -->
                    <Button x:Name="PrevChapterButton" Classes="chapter-nav"
                            Click="OnPrevChapterClick"
                            ToolTip.Tip="Previous Chapter"
                            IsEnabled="False">
                        <Viewbox Width="14" Height="14" Stretch="Uniform">
                            <Canvas Width="24" Height="24">
                                <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2.5" Data="M11 17L6 12l5-5" />
                                <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2.5" Data="M18 17l-5-5 5-5" />
                            </Canvas>
                        </Viewbox>
                    </Button>
                    <!-- Previous page -->
                    <Button x:Name="PrevPageButton" Classes="nav-btn"
                            Click="OnPreviousClick"
                            ToolTip.Tip="Previous page">
                        <Viewbox Width="16" Height="16" Stretch="Uniform">
                            <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                  StrokeThickness="2.5" Data="M15 18L9 12l6-6" />
                        </Viewbox>
                    </Button>
                </StackPanel>
                
                <!-- Center: slider and page info -->
                <Grid Grid.Column="1" Margin="12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock x:Name="PageIndicator"
                               Grid.Column="0"
                               Text="1 / 1"
                               Foreground="#94a3b8"
                               FontWeight="SemiBold"
                               FontSize="12"
                               VerticalAlignment="Center"
                               MinWidth="70"
                               TextAlignment="Center"
                               Margin="0,0,10,0" />
                    
                    <Slider x:Name="PageSlider"
                            Grid.Column="1"
                            Minimum="1" Maximum="1" Value="1"
                            VerticalAlignment="Center"
                            ValueChanged="OnPageSliderChanged" />
                </Grid>
                
                <!-- Right nav controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <!-- Next page -->
                    <Button x:Name="NextPageButton" Classes="nav-btn"
                            Click="OnNextClick"
                            ToolTip.Tip="Next page">
                        <Viewbox Width="16" Height="16" Stretch="Uniform">
                            <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                  StrokeThickness="2.5" Data="M9 18l6-6-6-6" />
                        </Viewbox>
                    </Button>
                    <!-- Next chapter -->
                    <Button x:Name="NextChapterButton" Classes="chapter-nav"
                            Click="OnNextChapterClick"
                            ToolTip.Tip="Next Chapter"
                            IsEnabled="False">
                        <Viewbox Width="14" Height="14" Stretch="Uniform">
                            <Canvas Width="24" Height="24">
                                <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2.5" Data="M13 17l5-5-5-5" />
                                <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2.5" Data="M6 17l5-5-5-5" />
                            </Canvas>
                        </Viewbox>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Help Overlay -->
        <Border x:Name="HelpOverlay"
                Classes="overlay"
                Grid.RowSpan="3"
                Background="#f00d0d1a"
                IsVisible="False">
            <Border Background="#202442"
                    CornerRadius="14"
                    Padding="36"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    MinWidth="400"
                    MaxWidth="640">
                <StackPanel Spacing="16">
                    <TextBlock Text="Keyboard Shortcuts"
                               Foreground="White"
                               FontSize="20"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center" />
                    
                    <StackPanel Spacing="10">
                        <TextBlock Text="Navigation" Foreground="#888" FontWeight="SemiBold" />
                        <Border Classes="shortcut-row">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="← / →" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Previous / Next page" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row alt">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Home / End" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="First / Last page" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="1-9" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Jump to position in chapter" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        
                        <TextBlock Text="View" Foreground="#888" FontWeight="SemiBold" Margin="0,8,0,0" />
                        <Border Classes="shortcut-row alt">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="+ / −" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Zoom in / out" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Ctrl+Scroll" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Mouse wheel zoom" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row alt">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="0" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Reset zoom to 100%" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="W" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Cycle fit mode" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row alt">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="P" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Toggle double-page view" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="R" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Toggle RTL (right-to-left)" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row alt">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="C" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Open chapters list" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="F / F11" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Toggle fullscreen" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        
                        <TextBlock Text="General" Foreground="#888" FontWeight="SemiBold" Margin="0,8,0,0" />
                        <Border Classes="shortcut-row alt">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="H / ?" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Show/hide this help" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                        <Border Classes="shortcut-row">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Esc / Q" Foreground="#60a5fa" FontFamily="Consolas" Width="120" />
                                <TextBlock Text="Close reader" Foreground="#ccc" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                    
                    <Button Click="OnHelpCloseClick"
                            Background="#3a3a5a"
                            Foreground="White"
                            Padding="20,10"
                            Margin="0,8,0,0"
                            CornerRadius="10"
                            HorizontalAlignment="Center"
                            ToolTip.Tip="Close shortcuts overlay">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Viewbox Width="16" Height="16" Stretch="Uniform">
                                <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                      StrokeThickness="2"
                                      StrokeLineCap="Round"
                                      Data="M5 12l4 4 10-10" />
                            </Viewbox>
                            <TextBlock Text="Got it" FontWeight="SemiBold" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Border>
        </Border>
        
        <!-- Error Overlay -->
        <Border x:Name="ErrorOverlay"
                Classes="overlay"
                Grid.RowSpan="3"
                Background="#f01a1a2e"
                IsVisible="False">
            <Border Background="#23263f"
                    CornerRadius="14"
                    Padding="28"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center">
                <StackPanel VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Spacing="12">
                    <TextBlock Text="⚠"
                               Foreground="#f87171"
                               FontSize="48"
                               HorizontalAlignment="Center" />
                    <TextBlock x:Name="ErrorText"
                               Text="Failed to load pages"
                               Foreground="#f87171"
                               FontSize="18"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxWidth="400" />
                    <Button Content="Close"
                            Click="OnCloseClick"
                            Padding="18,10"
                            CornerRadius="10"
                            Margin="0,8,0,0"
                            HorizontalAlignment="Center"
                            ToolTip.Tip="Close reader" />
                </StackPanel>
            </Border>
        </Border>
        
        <!-- Page Toast (center indicator) -->
        <Border x:Name="PageToast"
                Grid.RowSpan="3"
                Background="#cc000000"
                CornerRadius="10"
                Padding="24,12"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                IsVisible="False"
                IsHitTestVisible="False">
            <TextBlock x:Name="PageToastText"
                       Text="1 / 1"
                       Foreground="#e2e8f0"
                       FontWeight="SemiBold"
                       FontSize="18" />
        </Border>
        
        <!-- Chapters Panel Overlay (click to close) -->
        <Border x:Name="ChaptersOverlay"
                Grid.RowSpan="3"
                Background="#80000000"
                IsVisible="False"
                PointerPressed="OnChaptersOverlayClick">
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.3" />
                </Transitions>
            </Border.Transitions>
        </Border>
        
        <!-- Chapters Slide-in Panel -->
        <Border x:Name="ChaptersPanel"
                Grid.RowSpan="3"
                HorizontalAlignment="Right"
                Width="320"
                Background="#0f172a"
                BorderBrush="#1e293b"
                BorderThickness="1,0,0,0"
                IsVisible="False">
            <Border.Transitions>
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3" />
                </Transitions>
            </Border.Transitions>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                
                <!-- Panel header -->
                <Border Grid.Row="0" 
                        Padding="16"
                        BorderBrush="#1e293b"
                        BorderThickness="0,0,0,1">
                    <Grid>
                        <TextBlock Text="Chapters"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="#e2e8f0"
                                   VerticalAlignment="Center" />
                        <Button HorizontalAlignment="Right"
                                Background="Transparent"
                                Foreground="#94a3b8"
                                Padding="4"
                                Click="OnChaptersPanelClose">
                            <TextBlock Text="✕" FontSize="20" />
                        </Button>
                    </Grid>
                </Border>
                
                <!-- Chapters list -->
                <ScrollViewer Grid.Row="1" Padding="8">
                    <StackPanel x:Name="ChaptersList" Spacing="4">
                        <!-- Chapters will be added dynamically -->
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Window>
